---
layout: post
title: "Today I Learned: 27th Nov, 2018"
categories: til
tags: [TIL, Django, Unittest]
---

# 181127 일하면서 배운 것

오늘은 특별히 테스트케이스를 짜는 Workflow에 대해 소상히 배웠습니다.

이메일 관련 Logic flow

* 이메일입력을 하면 validation
    * is_valid? (`conditions:<email>@rgpkorea.co.kr`) [form에 대한 테스트케이스]
        * if true: conditions의 이메일이 등록되어있나?(회원가입 되어있는 이메일?)[form]
            * if true: 구독신청이 되어있나? (is_subscribed == False) [form]
                * 구독자로 추가

* 구독자에 대해 메일전송
    * 공휴일, 주말엔 안보냄? => 오늘이 공휴일/주말이면 안보낸다.

    * 주중이고 일하는 날에는…
        * 오늘의 일정이 몇개인가를 이메일보내준다
            * 있으면: 오늘 2일 전후에 이벤트가 n개 있으면 n건에 대한 메일을 보내주나?  
            * 없으면 : 오늘 2일 전후에 이벤트가 없으면 0건에 대한 메일을 보내주나?

작성해야될 테스트케이스
1. email validations
    1. 입력한 이메일이 @rgpkorea.co.kr 로 끝나지 않으면 400으로 응답해야 한다.
    2. 입력한 이메일이 AlertYo를 구독한 이메일이 아니면(회원가입 로직을 다른 곳에 맡김, subscriber에 본인 id가 등록되지 않은 이메일에 대하여...) 40x으로 응답해야 한다.
    3. 입력한 이메일이 이미 구독중인 이메일이라면 40x으로 응답해야 한다.

2. 이메일 전송 부분
    1. 오늘이 주말/공휴일이면 이메일 전송을 하지 말아야 된다. => check_today_is_send_day() 이 ‘오늘은 이메일 안보내는 날’(False)을 리턴해야 한다.
    2. 오늘이 주말/공휴일이 아니면 이메일 전송을 해야 된다. => check_today_is_send_day()이 ‘오늘은 이메일 보내는 날’(False)을 리턴해야 된다.

3. 이벤트 가져오는 부분
    1. 11/24 ~ 11/30일(오늘은 11/27) 까지의 이벤트가 있다면 11/25 ~ 11/29 까지의 이벤트를 가져와야 한다. => retreive_sent_events() 가 11/25 ~ 11/29 의 이벤트(QuerySet)를 리턴해야 된다.
    2. 11/24 ~ 11/30일(오늘은 11/27) 까지의 이벤트가 없다면 빈 리스트를 리턴해야 된다. => retreive_sent_events() 가 empty queryset을 리턴해야 된다.

---

위 과정을 논의하면서 배운 것들을 요약하자면 다음과 같다:

1. 조건을 잘 나누는 것이 핵심이다
2. if condition마다 메소드를 나누어서 작성하자
    * 나누어진 메소드마다 테스트 범위가 된다
3. 발생한 예외가 어떤 것들이 있을지 확실히 컨트롤하자
4. [추가됨] 각 유닛에 대해 테스트코드를 작성하기도 하고, 풀 로직이 잘 도는지 테스트하기도 한다. 둘 중 하나만이 아니라 둘 다 있을 수 있는 것이다.
