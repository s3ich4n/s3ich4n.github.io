<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.df24740150fa618c04d0.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="팔공산 창고" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=null"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'null', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=db70af0ea91e1b7f724468508a30ef0f" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=db70af0ea91e1b7f724468508a30ef0f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=db70af0ea91e1b7f724468508a30ef0f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=db70af0ea91e1b7f724468508a30ef0f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=db70af0ea91e1b7f724468508a30ef0f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=db70af0ea91e1b7f724468508a30ef0f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=db70af0ea91e1b7f724468508a30ef0f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=db70af0ea91e1b7f724468508a30ef0f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=db70af0ea91e1b7f724468508a30ef0f"/><title data-react-helmet="true">Docker pt.02 도커를 자세히 알아보자 - 팔공산 창고</title><meta data-react-helmet="true" name="description" content="Docker를 알아봅시다. (2번째 글)"/><meta data-react-helmet="true" property="og:site_name" content="Docker pt.02 도커를 자세히 알아보자 - 팔공산 창고"/><meta data-react-helmet="true" property="og:image" content="https://blog.s3ich4n.me/dinergate.gif"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Docker pt.02 도커를 자세히 알아보자 - 팔공산 창고"/><meta data-react-helmet="true" name="twitter:description" content="Docker를 알아봅시다. (2번째 글)"/><meta data-react-helmet="true" name="twitter:image" content="https://blog.s3ich4n.me/dinergate.gif"/><link as="script" rel="preload" href="/webpack-runtime-9ae0905d361500d31f5e.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-c4084fbc8dbdb706860f.js"/><link as="script" rel="preload" href="/app-135d302a68f227ecea21.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-9fbe5923646f8b5e332a.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-91b2a688d925efe98d67.js"/><link as="fetch" rel="preload" href="/page-data/posts/devlog/devops/docker-explained-pt02/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Docker pt.02 도커를 자세히 알아보자</h1><div class="Content-module--content__body--2TrQ-"><h1 id="도커의-개념에-대해-알아보자" style="position:relative;"><a href="#%EB%8F%84%EC%BB%A4%EC%9D%98-%EA%B0%9C%EB%85%90%EC%97%90-%EB%8C%80%ED%95%B4-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90" aria-label="도커의 개념에 대해 알아보자 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>도커의 개념에 대해 알아보자</h1>
<p>도커의 방식에 따라 개발을 한다고 하면 아래와 같다:</p>
<ol>
<li>컨테이너 구축: 앱</li>
<li>서비스를 구축: 컨테이너가 어떻게 프로덕션 환경에서 작동하는가를 정의</li>
<li>스택을 구축: 모든 서비스 간 상호작용에 대해 정의</li>
</ol>
<h2 id="새로운-환경을-구축하는-방식" style="position:relative;"><a href="#%EC%83%88%EB%A1%9C%EC%9A%B4-%ED%99%98%EA%B2%BD%EC%9D%84-%EA%B5%AC%EC%B6%95%ED%95%98%EB%8A%94-%EB%B0%A9%EC%8B%9D" aria-label="새로운 환경을 구축하는 방식 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>새로운 환경을 구축하는 방식</h2>
<p>원래는 가상환경을 설치하고 요구사항을 적어줘야했다면 이미지로 파이썬 런타임을 얻어둔다. 그 후 빌드는 기존의 파이썬 이미지를 코드에 추가하여 앱, 의존성, 런타임이 동시에 돌아가도록 한다. 이런류의 가상 이미지는 <code class="language-text">Dockerfile</code>안에 정의된다.</p>
<h2 id="컨테이너를-dockerfile과-함께-정의" style="position:relative;"><a href="#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%A5%BC-dockerfile%EA%B3%BC-%ED%95%A8%EA%BB%98-%EC%A0%95%EC%9D%98" aria-label="컨테이너를 dockerfile과 함께 정의 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>컨테이너를 <code class="language-text">Dockerfile</code>과 함께 정의</h2>
<p><code class="language-text">Dockerfile</code>은 컨테이너 안에 뭐가 들어갈지 에 대해 정의한 것이다. 네트워크 인터페이스, 디스크 드라이브처럼 리소스에 접근하는 것은 환경내에 가상화 되어있으며 이 것들은 시스템의 나머지와 격리되어있다. 그렇기 때문에 외부에 나가는 포트를 매핑해줘야하고, 어떤 파일이 환경설정에 복사되는지 구체화해야 한다. 이런식으로 정의 한 후에는 <code class="language-text">Dockerfile</code>에 정의된 앱의 빌드가 어디서든 똑같이 작동한다고 할 수 있다.</p>
<h2 id="빌드까지-해보자" style="position:relative;"><a href="#%EB%B9%8C%EB%93%9C%EA%B9%8C%EC%A7%80-%ED%95%B4%EB%B3%B4%EC%9E%90" aria-label="빌드까지 해보자 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>빌드까지 해보자</h2>
<p>여기서부터는 Docker의 공식문서와 똑같다.</p>
<ol>
<li>도커 <strong>이미지</strong> 를 만든다(<code class="language-text">build</code>)</li>
<li>도커 이미지에 tag를 붙인다</li>
<li>
<p>그 후?</p>
<ol>
<li>
<p>로컬에서 돌린다</p>
<ul>
<li>로컬에 도는 <strong>컨테이너</strong> 를 <code class="language-text">docker container ls</code> 로 확인한다</li>
</ul>
</li>
<li>
<p>배포한다 (이를테면 <code class="language-text">push</code>로)</p>
<ul>
<li><code class="language-text">registry</code>에 배포한다; 이는 리포지토리의 컬렉션</li>
<li>리포지토리는 이미지의 컬렉션; 코드가 이미 빌드되어있다는 점을 빼고는 github 리포랑 비슷한 느낌</li>
<li>docker hub에 docker login을 하고 <code class="language-text">push</code></li>
</ul>
</li>
</ol>
</li>
</ol>
<h1 id="service는-무슨-개념인가" style="position:relative;"><a href="#service%EB%8A%94-%EB%AC%B4%EC%8A%A8-%EA%B0%9C%EB%85%90%EC%9D%B8%EA%B0%80" aria-label="service는 무슨 개념인가 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Service는 무슨 개념인가?</h1>
<p>앱 로드밸런싱과 앱 스케일 조절도 가능해진다. 분산 앱에서는 여러 부분의 앱을 가지고 “services” 라고 부른다. 예를들어 동영상 공유 사이트가 있다고 하자. 거기엔 앱 데이터를 DB에 저장하는 서비스, 사용자가 업로드 후 비디오 인/디코딩을 수행하는 서비스, 프론트엔드 서비스, 등이 있을 것이다.</p>
<p>“service”는 "" 이다. 서비스는 하나의 이미지에서만 돌아가지만, 이미지가 돌아가는 방식을 기술해둔다. 예를들면 몇번 포트가 써져야하는지, 몇가지 컨테이너 복제본이 돌아서 얼마나 버틸지 등이 대표적이다. 서비스를 “스케일링” 하는 것은 소프트웨어 조각을 돌리는 컨테이너 수를 변경하는 것이며, 이는 프로세스 내의 서비스에 많은 컴퓨팅 리소스를 할당하는 것이다.</p>
<p>이런 것들은 도커에선 굉장히 간단하다. <code class="language-text">docker-compose.yml</code> 파일을 만들고 수정하면 되기 때문이다. 도커 공식문서의 예시를 보고 파악해보자.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token comment"># web이라는 이름의 서비스를 돌림</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> s3ich4n/get<span class="token punctuation">-</span>started<span class="token punctuation">:</span>pt02
    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
      <span class="token comment"># 몇개의 동일한 컨테이너를 굴릴건지?</span>
      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">5</span> 
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token key atrule">limits</span><span class="token punctuation">:</span>
          <span class="token comment"># 컨테이너당 10%의 CPU 싱글코어 시간만큼 돌고 메모리는 50M 쓴다</span>
          <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">"0.1"</span>
          <span class="token key atrule">memory</span><span class="token punctuation">:</span> 50M
        <span class="token key atrule">restart_policy</span><span class="token punctuation">:</span>
          <span class="token comment"># 하나가 문제가 생기면 바로 재시작</span>
          <span class="token key atrule">condition</span><span class="token punctuation">:</span> on<span class="token punctuation">-</span>failure
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"4000:80"</span> <span class="token comment"># 4000번을 80번으로 매핑</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token comment"># 'web'의 컨테이너가 80번 포트를 webnet 이라하는</span>
      <span class="token comment"># 로드밸런스 네트워크에 공유하도록 세팅함</span>
      <span class="token punctuation">-</span> webnet 
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token comment"># webnet 네트워크를 기본값으로 둠</span>
  <span class="token comment"># 이는 로드밸런스 오버레이 네트워크다</span>
  webnet<span class="token punctuation">:</span></code></pre></div>
<h2 id="로드밸런스가-적용된-앱을-굴려보자" style="position:relative;"><a href="#%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8A%A4%EA%B0%80-%EC%A0%81%EC%9A%A9%EB%90%9C-%EC%95%B1%EC%9D%84-%EA%B5%B4%EB%A0%A4%EB%B3%B4%EC%9E%90" aria-label="로드밸런스가 적용된 앱을 굴려보자 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>로드밸런스가 적용된 앱을 굴려보자</h2>
<p><code class="language-text">docker stack deploy</code>를 쓰기 전에 아래 명령어를 먼저 입력하자.</p>
<blockquote>
<p><code class="language-text">docker swarm init</code></p>
</blockquote>
<p>이걸 안치면 이런 에러가 난다: <code class="language-text">this node is not a swarm manager</code></p>
<p>그 후 앱 이름을 하나 만들어주면 된다.</p>
<p><code class="language-text">docker stack deploy -c docker-compose.yml getstartedlab</code></p>
<p>이런 식으로 돌리면 5개의 컨테이너가 돌거다.</p>
<p><code class="language-text">docker-compose.yml</code>을 바꾸고 <code class="language-text">docker stack deploy</code>를 다시 실행시키면 된다. 껐다가 재부팅할 필요는 없다.</p>
<p>은근히 나오는 <code class="language-text">swarm</code>의 개념은 아래에서 설명하도록 한다.</p>
<h1 id="swarm은-어떤-개념인가" style="position:relative;"><a href="#swarm%EC%9D%80-%EC%96%B4%EB%96%A4-%EA%B0%9C%EB%85%90%EC%9D%B8%EA%B0%80" aria-label="swarm은 어떤 개념인가 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Swarm은 어떤 개념인가?</h1>
<p>앱을 클러스터에 올리고 여러 머신에서 구동하는 것도 가능하다. 멀티컨테이너, 멀티머신앱을 일종의 도커로 묶인(<code class="language-text">Dockerized</code>) 클러스터로 쓸 수 있다. 이들은 <code class="language-text">Swarm</code>(이하 스웜)이라고 부른다.</p>
<h2 id="swarm-클러스터에-대해" style="position:relative;"><a href="#swarm-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EC%97%90-%EB%8C%80%ED%95%B4" aria-label="swarm 클러스터에 대해 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Swarm 클러스터에 대해</h2>
<p><code class="language-text">Swarm</code>은 도커가 작동중이고, 클러스터로 묶인 머신의 그룹이다. 묶이고 난 후에도 도커 커맨드는 그대로 쓸 수 있다. 그렇지만 <code class="language-text">swarm manager</code>에 의해 클러스터 상에서 수행된다. 스웜에 포함된 머신은 물리적일수도, 가상일 수도 있다. 스웜에 포함된 후에는 <code class="language-text">node</code>라고 부른다.</p>
<p>스웜 매니저는 여러 정책을 사용해서 컨테이너를 돌릴 수 있다. 크게 두가지 모드가 있는데, <code class="language-text">emptiest node</code>와 <code class="language-text">global</code>이 그것이다. <code class="language-text">emptiest node</code>는 가장 적게 쓰이는 머신과 컨테이너를 채우는 방식이다. <code class="language-text">global</code>은 각각의 머신들이 정확히 특정한 컨테이너 하나를 가진다고 가정하는 방식이다. 운영시에는 스웜 매니저가 Compose 파일에 이런 정책을 사용하도록 지시한다. 하나의 컨테이너에 대해 하던 것과 비슷하다.</p>
<p>스웜 매니저는 명령어를 수행하거나 다런 머신이 swarm에 <code class="language-text">worker</code>로 들어갈 수 있는 권한을 주는 스웜의 유일한 머신이다. <code class="language-text">worker</code>는 단순히 capacity만을 제공하고 다른기계에게 무엇은 할 수 있고, 무엇은 할 수 없고 를 말할 권한이 없다.</p>
<p>지금까지의 예제는 로컬에서 single-host모드로 도커를 사용했지만, 도커는 swarm mode로 스왑할 수 있다. 이 모드가 스웜을 사용할 수 있게 해준다. 스웜모드를 바로 켜면 현재 머신을 스웜매니저로 만든다. 그 때부터 도커는 본인이 관리하는 스웜에 입력한 명령을 수행한다. 현재 머신이 일을 수행하지 않음에 유의하라.</p>
<h2 id="스웜-세팅하기" style="position:relative;"><a href="#%EC%8A%A4%EC%9B%9C-%EC%84%B8%ED%8C%85%ED%95%98%EA%B8%B0" aria-label="스웜 세팅하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>스웜 세팅하기</h2>
<p>스웜은 앞서 말했다시피 여러개의 물리/가상노드로 구성되어있다. 스웜을 세팅하는 기본 개념은 다음과 같다. <code class="language-text">docker swarm init</code>을 수행해서 스웜 모드에 돌입해서 현재 머신을 스웜 매니저로 만든다. 그후 다른 머신이 <code class="language-text">docker swarm join</code>을 입력하여 스웜에 worker로 들어오게 한다. 클러스터를 로컬 VM같은걸로 해서 실습하는 세션을 따라해보자.</p>
<ol>
<li><code class="language-text">docker-machine</code>을 통해 여러개의 가상머신을 구축</li>
<li>VM리스트를 보고 IP 확인하기</li>
<li>
<p>swarm 초기화 및 node 추가</p>
<ol>
<li><code class="language-text">docker-machine ssh myvm1 "docker swarm init --advertise-addr &lt;myvm1 ip>"</code> 을 수행하면 <code class="language-text">myvm1</code> 노드는 스웜 매니저가 된다.</li>
</ol>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ docker-machine <span class="token function">ssh</span> myvm1 <span class="token string">"docker swarm init --advertise-addr &lt;myvm1 ip>"</span>
Swarm initialized: current <span class="token function">node</span> <span class="token operator">&lt;</span>node ID<span class="token operator">></span> is now a manager.

To <span class="token function">add</span> a worker to this swarm, run the following command:

  <span class="token function">docker</span> swarm <span class="token function">join</span> <span class="token punctuation">\</span>
  --token <span class="token operator">&lt;</span>token<span class="token operator">></span> <span class="token punctuation">\</span>
  <span class="token operator">&lt;</span>myvm ip<span class="token operator">></span>:<span class="token operator">&lt;</span>port<span class="token operator">></span>

To <span class="token function">add</span> a manager to this swarm, run <span class="token string">'docker swarm join-token manager'</span> and follow the instructions.</code></pre></div>
<blockquote>
<p>Tip: 2377, 2376포트?</p>
<p>해당 포트는 도커의 스웜 관리용 포트로 쓰인다. 가급적 해당 포트를 피해서 사용하기를 권장한다.</p>
</blockquote>
<ol start="2">
<li><code class="language-text">docker-machine ssh myvm2 "docker swarm join --token &lt;token> &lt;ip>:2377"</code>를 수행하면 해당 노드는 worker가 된다.</li>
</ol>
<blockquote>
<p>Tip: 스웜을 나가려면?</p>
<p><code class="language-text">docker swarm leave</code>를 각 노드별로 실행하기.</p>
</blockquote>
</li>
<li>
<p>앱을 swarm cluster 상에서 구동하기:<br>
<strong>스웜 매니저</strong>가 도커 명령을 수행할 수 있다는 점을 염두에 두고 작업하자!</p>
<ol>
<li>스웜 매니저의 명령을 바로 수행하기 위해 옵션을 가져오자</li>
</ol>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ docker-machine <span class="token function">env</span> myvm1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">DOCKER_TLS_VERIFY</span><span class="token operator">=</span><span class="token string">"1"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">DOCKER_HOST</span><span class="token operator">=</span><span class="token string">"tcp://192.168.99.100:2376"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">DOCKER_CERT_PATH</span><span class="token operator">=</span><span class="token string">"/Users/sam/.docker/machine/machines/myvm1"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">DOCKER_MACHINE_NAME</span><span class="token operator">=</span><span class="token string">"myvm1"</span>
<span class="token comment"># Run this command to configure your shell:</span>
<span class="token comment"># eval $(docker-machine env myvm1)</span></code></pre></div>
<ol start="2">
<li>그 후 <code class="language-text">myvm1</code>에서 해당 명령어를 실행시켜 앱을 배포하자!<br>
<br>
<code class="language-text">docker stack deploy -c docker-compose.yml getstartedlab</code></li>
</ol>
<blockquote>
<p>Docker Hub의 private registry에 있다면 docker login을 먼저 하고<br>
스웜노드들이 그걸 알고있어야한다!</p>
<p>따라서 먼저 로그인을 하고 <code class="language-text">--with-registry-auth -c</code> 옵션을 함께 주면 된다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker</span> login registry.example.com
<span class="token punctuation">..</span>.
$ <span class="token function">docker</span> stack deploy --with-registry-auth -c docker-compose.yml getstartedlab
<span class="token punctuation">..</span>.</code></pre></div>
<p>이런식으로 로컬에서 스웜 노드들에게 토큰을 보내주어야 정상접근이 가능하다.</p>
</blockquote>
</li>
</ol>
<p>설정이 끝나고 <code class="language-text">192.168.99.100</code>, <code class="language-text">192.168.99.101</code> 둘다 접근하면 앱이 뜬다.<br>
로컬에서 연습할 때는 도커 켜고 실행하는거 까먹지 말고 돌리기!</p>
<ol start="5">
<li>stack 및 swarm을 끄려면?</li>
</ol>
<blockquote>
<p><code class="language-text">docker stack rm getstartedlab</code></p>
</blockquote>
<blockquote>
<p>Tip: <code class="language-text">docker swarm leave</code>를 수행하면<br>
현재 속한 스웜에서 나간다. (매니저일 때는 <code class="language-text">--force</code>옵션 필요!)</p>
</blockquote>
<ol start="6">
<li><code class="language-text">docker-machine</code>쉘 환경변수 해지하기</li>
</ol>
<blockquote>
<p><code class="language-text">eval $(docker-machine env -u)</code></p>
</blockquote>
<h1 id="stack은-어떤-개념인가" style="position:relative;"><a href="#stack%EC%9D%80-%EC%96%B4%EB%96%A4-%EA%B0%9C%EB%85%90%EC%9D%B8%EA%B0%80" aria-label="stack은 어떤 개념인가 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stack은 어떤 개념인가?</h1>
<p>분산앱의 가장 끝자락에 있는 <code class="language-text">Stack</code>이란 개념은, 의존성을 공유하는 상호연관된 서비스들의 그룹이다. 또한 함께 orchestrate되고 스케일을 조절받을 수 있다. 단일 스택은 전체 응용 프로그램의 기능을 정의하고 조정할 수 있다(매우 복잡한 응용 프로그램이 여러 스택을 사용할 수도 있음). 여러 서비스를 같이 한다고 했을 때를 생각해보자! <code class="language-text">docker-compose.yml</code>을 수정하고 예제를 따라해보며 이해해보자. indent에 주의!</p>
<ol>
<li><code class="language-text">docker-compose.yml</code> 수정하기 (1) <br>
<code class="language-text">visualiser</code> 추가하기</li>
</ol>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># yml은 indent에 굉장히 민감하기 때문에 더 꼼꼼하게 봐야함</span>

<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token comment"># web이라는 이름의 서비스를 돌림</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> s3ich4n/get<span class="token punctuation">-</span>started<span class="token punctuation">:</span>pt2
    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
      <span class="token comment"># 몇개의 동일한 컨테이너를 굴릴건지?</span>
      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span> 
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token key atrule">limits</span><span class="token punctuation">:</span>
          <span class="token comment"># 컨테이너당 10%의 CPU 싱글코어 시간만큼 돌고 메모리는 50M 쓴다</span>
          <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">"0.1"</span>
          <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"50M"</span>
      <span class="token key atrule">restart_policy</span><span class="token punctuation">:</span>
          <span class="token comment"># 하나가 문제가 생기면 바로 재시작</span>
        <span class="token key atrule">condition</span><span class="token punctuation">:</span> on<span class="token punctuation">-</span>failure
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"4000:80"</span> <span class="token comment"># 4000번을 80번으로 매핑</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token comment"># 'web'의 컨테이너가 80번 포트를 webnet 이라하는</span>
      <span class="token comment"># 로드밸런스 네트워크에 공유하도록 세팅함</span>
      <span class="token punctuation">-</span> webnet
  <span class="token key atrule">visualizer</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> dockersamples/visualizer<span class="token punctuation">:</span>stable
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8080:8080"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"/var/run/docker.sock:/var/run/docker.sock"</span>
    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
      <span class="token key atrule">placement</span><span class="token punctuation">:</span>
        <span class="token key atrule">constraints</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>node.role == manager<span class="token punctuation">]</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> webnet
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token comment"># webnet 네트워크를 기본값으로 둠</span>
  <span class="token comment"># 이는 로드밸런스 오버레이 네트워크다</span>
  webnet<span class="token punctuation">:</span></code></pre></div>
<p>  visualiser라는 서비스가 하나 더 추가됐고, 그 속에 <code class="language-text">volumes</code>라는 키와 <code class="language-text">placement</code>라는 키가 함께 추가되었다. <code class="language-text">volumes</code>는 <code class="language-text">visualiser</code>가 호스트의 도커를 위한 소켓파일에 접근권한을 주는 것이고, <code class="language-text">placement</code>는 해당 서비스가 오직 스웜 매니저에서만 작동하도록 하는 것이다(워커는 안됨).
이 키를 준 이유는 <a href="https://github.com/dockersamples/docker-swarm-visualizer" target="_blank" rel="nofollow noopener noreferrer">visualiser가 그렇게 만들어져셔</a>다.</p>
<ol start="2">
<li><code class="language-text">myvm1</code> 환경변수를 로드 후 쉘 조작</li>
</ol>
<p>  위 그림과 같이 <code class="language-text">visualiser</code>는 하나의 단일 이미지를 갖고있고, <code class="language-text">web</code> 인스턴스는 스웜에 나누어져있다. <code class="language-text">docker stack ps getstartedlab</code>으로도 확인할 수 있다. <code class="language-text">visualiser</code>는 스택이 포함된 모든 앱에서 실행할 수 있는 스탠드얼론 서비스다. 다른 것에 의존하지 않는다. 이번엔 <strong>의존</strong>하는 서비스를 달아보자. <code class="language-text">Redis</code>를 통해 방문자 카운트를 수행하는 서비스이다.</p>
<ol start="3">
<li><code class="language-text">docker-compose.yml</code> 수정하기 (2)<br>
<code class="language-text">redis</code> 추가하기</li>
</ol>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># yml은 indent에 굉장히 민감하기 때문에 더 꼼꼼하게 봐야함</span>

<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token comment"># web이라는 이름의 서비스를 돌림</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> s3ich4n/get<span class="token punctuation">-</span>started<span class="token punctuation">:</span>pt2
    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
      <span class="token comment"># 몇개의 동일한 컨테이너를 굴릴건지?</span>
      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token key atrule">limits</span><span class="token punctuation">:</span>
          <span class="token comment"># 컨테이너당 10%의 CPU 싱글코어 시간만큼 돌고 메모리는 50M 쓴다</span>
          <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">"0.1"</span>
          <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"50M"</span>
      <span class="token key atrule">restart_policy</span><span class="token punctuation">:</span>
          <span class="token comment"># 하나가 문제가 생기면 바로 재시작</span>
        <span class="token key atrule">condition</span><span class="token punctuation">:</span> on<span class="token punctuation">-</span>failure
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"4000:80"</span> <span class="token comment"># 4000번을 80번으로 매핑</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token comment"># 'web'의 컨테이너가 80번 포트를 webnet 이라하는</span>
      <span class="token comment"># 로드밸런스 네트워크에 공유하도록 세팅함</span>
      <span class="token punctuation">-</span> webnet
  <span class="token key atrule">visualizer</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> dockersamples/visualizer<span class="token punctuation">:</span>stable
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8080:8080"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"/var/run/docker.sock:/var/run/docker.sock"</span>
    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
      <span class="token key atrule">placement</span><span class="token punctuation">:</span>
        <span class="token key atrule">constraints</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>node.role == manager<span class="token punctuation">]</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> webnet
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"6379:6379"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"/home/docker/data:/data"</span>
    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
      <span class="token key atrule">placement</span><span class="token punctuation">:</span>
        <span class="token key atrule">constraints</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>node.role == manager<span class="token punctuation">]</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>server <span class="token punctuation">-</span><span class="token punctuation">-</span>appendonly yes
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> webnet
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token comment"># webnet 네트워크를 기본값으로 둠</span>
  <span class="token comment"># 이는 로드밸런스 오버레이 네트워크다</span>
  webnet<span class="token punctuation">:</span></code></pre></div>
<p><code class="language-text">Redis</code>는 도커 라이브러리의 공식이미지가 있고, 그렇기에 이름이 저렇게 짧아도 된다. Redis 포트 6379는 컨테이너에서 호스트로 노출되도록 Redis에 의해 사전 구성되어 있다. 여기에서 Compose 파일에는 호스트에서 리얼월드로 노출되므로 실제로 호스트의 IP 주소를 입력 할 수 있다. 필요에 따라 노드를 Redis Desktop Manager로 가져 와서 Redis 인스턴스를 관리할 수도 있다.</p>
<p>또한 레디스 스펙상에는 몇가지 중요한 사항이 있다. 이것은 구현체들 사이에서 데이터가 변하지 않고 해준다. 다시말해 여러 구현체들이 값을 변경해도 일정하게 유지하도록 해준다는 말이다.</p>
<ul>
<li><code class="language-text">redis</code>는 항상 매니저상에서 돌아간다. 그러므로 동일한 파일 시스템을 사용한다.</li>
<li><code class="language-text">redis</code>는 컨테이너 속의 <code class="language-text">/data</code>라는 호스트의 가상 디렉토리를 접근한다. 이는 <code class="language-text">Redis</code>가 데이터를 저장하는 곳이다.</li>
</ul>
<p>이들이 같이 있음으로서 Redis 데이터에 대한 호스트의 물리 파일시스템에 ‘단일정보(source of truth)‘를 만든다. 이 설정이 없다면, <code class="language-text">Redis</code>는 컨테이너 파일 시스템 내의 /data에 그 값을 저장할 것이며, 컨테이너가 재배포되면 값이 사라질 것이다.</p>
<p>이 ‘단일정보’는 두가지 구성요소를 가지고 있다.</p>
<ul>
<li>Redis 서비스에 둔 제약조건. 이는 항상 동일한 호스트를 가정한다.</li>
<li>컨테이너가 호스트의 <code class="language-text">./data</code>를 레디스 컨테이너의 <code class="language-text">/data</code>처럼 접근하도록 한 볼륨. 컨테이너가 동작하는 동안, 특정 호스트의 <code class="language-text">./data</code>에 저장된 파일들이 계속 유지되어 연속성을 유지한다.</li>
<li>
<p><code class="language-text">./data</code> 디렉토리를 스웜 매니저에 생성</p>
<p><code class="language-text">docker-machine ssh myvm1 "mkdir ./data"</code></p>
</li>
<li>
<p><code class="language-text">docker stack deploy</code>를 통해 서비스를 추가</p>
<p><code class="language-text">$ docker stack deploy -c docker-compose.yml getstartedlab</code></p>
</li>
</ul>
<h1 id="나만의-앱을-deploy하려면" style="position:relative;"><a href="#%EB%82%98%EB%A7%8C%EC%9D%98-%EC%95%B1%EC%9D%84-deploy%ED%95%98%EB%A0%A4%EB%A9%B4" aria-label="나만의 앱을 deploy하려면 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>나만의 앱을 deploy하려면?</h1>
<p>크게 두가지가 필요하다.</p>
<ul>
<li><code class="language-text">Dockerfile</code>로 앱 개발</li>
<li><code class="language-text">docker-compose.yml</code>로 <code class="language-text">Docker app</code>, <code class="language-text">service</code>, <code class="language-text">stack</code> 환경설정</li>
</ul>
<p>이 과정을 마치면 <code class="language-text">AWS</code>, <code class="language-text">Azure</code>, 등등 클라우드나 서버에 올리면 될 것이다. 앱이 필요한 프로토콜, 포트를 개방해주는 것도 필요할 것이니 개발시 스스로 알아보고 작업하면 될 것이다. Docker 이미지를 빌드하고 publish하면 어디서든 끌어쓸 수 있을 것이고… <del>나머지는 검색으로 다시 공부하면 될 것이다.</del> <a href="https://docs.docker.com/machine/overview/" target="_blank" rel="nofollow noopener noreferrer">이 링크</a>는 꼭 읽어보길 바란다. 문서를 따라읽으며 공부했다면 정말 크게 도움될 것..</p>
<h2 id="references" style="position:relative;"><a href="#references" aria-label="references permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h2>
<ul>
<li><a href="https://docs.docker.com/get-started/" target="_blank" rel="nofollow noopener noreferrer">Get Started pt.02 ~ pt.06</a></li>
<li><a href="https://subicura.com/2017/02/10/docker-guide-for-beginners-create-image-and-deploy.html" target="_blank" rel="nofollow noopener noreferrer">초보를 위한 도커 안내서</a></li>
</ul></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->May 18, 2019</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/dev-ops/">DevOps</a></li></ul></div><div class="Author-module--author--2Yefr">Die Grenzen meiner Sprache bedeuten die Grenzen meinen Welt. - Ludwig Wittgenstein</div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/devlog/devops/docker-explained-pt02";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-135d302a68f227ecea21.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-91533c34d4c04158b3bf.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-9a8ab6a02add1d489a0d.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-e133b6bf534af92835e5.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-ea42bffee1320a898f17.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-9a81f4ebf13f285e62da.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-91b2a688d925efe98d67.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-02327161be6f6fce449d.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-5eb45ea93f9e416dc132.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-91b2a688d925efe98d67.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-9fbe5923646f8b5e332a.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-135d302a68f227ecea21.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-c4084fbc8dbdb706860f.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-9ae0905d361500d31f5e.js" async=""></script></body></html>