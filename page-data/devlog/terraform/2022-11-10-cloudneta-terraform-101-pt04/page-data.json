{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/devlog/terraform/2022-11-10-cloudneta-terraform-101-pt04","result":{"data":{"markdownRemark":{"id":"26eaf5c8-2d60-5cb7-b3e7-607ab84b0069","html":"<p>이 내용은 CloudNet@ 에서 진행하는 테라폼 기초 입문 스터디에 대한 연재글입니다.</p>\n<p>스터디에서 사용하는 교재는 <a href=\"http://www.yes24.com/Product/Goods/101511312\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Terraform Up &#x26; Running 2nd Edition</a> 입니다.</p>\n<hr>\n<h1 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h1>\n<ul>\n<li>학습용 링크를 공유합니다.\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=yWhwZpzJ3no&#x26;t=2504s\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">(당근페이) 박병진님 - 확장 가능한 테라폼 코드 관리를 위한 원칙</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"테라폼의-모듈에-대하여\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EB%9D%BC%ED%8F%BC%EC%9D%98-%EB%AA%A8%EB%93%88%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC\" aria-label=\"테라폼의 모듈에 대하여 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테라폼의 모듈에 대하여</h1>\n<p>테라폼의 모듈이 등장하게 된 배경에 대해 살펴보고, 주의사항은 어떤 것이 있는지 알아봅시다.</p>\n<ul>\n<li>모듈은, 둘 이상의 환경에서 코드 재사용, 여러 테라폼 리소스를 하나의 논리적 그룹으로 관리하기 위해 사용합니다.\n<ul>\n<li>E.g., 스테이징, 프로덕션 환경에서 공통적으로 사용되는 코드를 <code class=\"language-text\">modules</code> 같은 디렉토리에 빼고, 파일경로를 참조하여 사용하는 것이 바로 그 방안입니다.</li>\n</ul>\n</li>\n</ul>\n<p>테라폼의 모듈은 아래와 같이 분류됩니다.</p>\n<ul>\n<li>\n<p>Root module</p>\n<ul>\n<li>모든 Terraform 구성에는 기본 작업 디렉토리 의 파일에 정의된 리소스로 구성된 <em>루트 모듈</em> 이라고 하는 하나 이상의 모듈 이 있습니다.</li>\n</ul>\n</li>\n<li>\n<p>Child module</p>\n<ul>\n<li>\n<p>Terraform 모듈(일반적으로 구성의 루트 모듈)은 다른 모듈을 <em>호출</em> 하여 해당 리소스를 구성에 포함할 수 있습니다. 다른 모듈에 의해 호출된 모듈을 종종 <em>자식 모듈이라고 합니다.</em></p>\n<p>자식 모듈은 동일한 구성 내에서 여러 번 호출할 수 있으며 여러 구성에서 동일한 자식 모듈을 사용할 수 있습니다.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>Published module</p>\n<ul>\n<li>로컬 파일 시스템의 모듈 외에도 Terraform은 공개 또는 비공개 레지스트리에서 모듈을 로드할 수 있습니다. 이렇게 하면 다른 사람이 사용할 수 있도록 모듈을 게시하고 다른 사람이 게시한 모듈을 사용할 수 있습니다.</li>\n<li><a href=\"https://registry.terraform.io/browse/modules\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Terraform Registry</a>에서 가져오거나, Terraform Cloud, Terraform Enterprise 같은 서비스를 사용하여 참조할 수 있습니다.</li>\n</ul>\n</li>\n</ul>\n<p>그렇다면 테라폼 모듈을 가져오는 소스는 어떤 것이 있을까요?</p>\n<ul>\n<li>로컬경로</li>\n<li>Terraform Registry</li>\n<li>GitHub</li>\n<li>Bitbucket</li>\n<li>GCS buckets, S3 buckets</li>\n<li>Terraform Registry\n<ul>\n<li>하시코프에서 공식적으로 운영하는 테라폼 프로바이더 및 모듈 저장소, 공개된 모듈을 쉽게 활용 가능합니다.</li>\n<li><a href=\"https://github.com/terraform-aws-modules\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[Github] terraform-aws-modules</a> : 하시코프 ambassador 중 한 명인 Anton Babenko 가 리드, 가장 인기 있는 AWS 테라폼 모듈을 관리하는 Github 조직입니다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"모듈-기본\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88-%EA%B8%B0%EB%B3%B8\" aria-label=\"모듈 기본 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈 기본</h2>\n<ul>\n<li>폴더에 있는 모든 테라폼 구성파일은 모듈입니다.</li>\n<li>현재 작업 디렉토리의 모듈은 루트 모듈이라고 부릅니다.</li>\n</ul>\n<p>모듈을 사용하기 위한 구문은 아래와 같습니다:</p>\n<div class=\"gatsby-highlight\" data-language=\"terraform\"><pre class=\"language-terraform\"><code class=\"language-terraform\">module &quot;&lt;NAME&gt;&quot; {\n  source = &quot;&lt;SOURCE&gt;&quot;\n\n  [CONFIG ...]\n}</code></pre></div>\n<ul>\n<li><strong>NAME</strong>\n<ul>\n<li>테라폼 코드 전체에서 참조하기 위해 사용하는 <strong>식별자</strong>입니다.</li>\n</ul>\n</li>\n<li><strong>SOURCE</strong>\n<ul>\n<li><code class=\"language-text\">modules/services/webserver-cluster</code> 와 같은 모듈 코드를 찾을 수 있는 <strong>경로</strong>입니다.</li>\n</ul>\n</li>\n<li><strong>CONFIG</strong>\n<ul>\n<li>그 모듈과 관련된 특정한 하나 이상의 인수로 구성됩니다.</li>\n</ul>\n</li>\n</ul>\n<p>모듈을 적용하거나 source 파라미터를 수정하는 경우 반드시 <code class=\"language-text\">terrraform init</code> 명령 실행이 필요합니다.</p>\n<p>다시말해 <code class=\"language-text\">init</code> 명령어 하나로 손쉽게 프로바이더와 모듈을 다운로드하고 백엔드를 구성할 수 있습니다.</p>\n<h2 id=\"모듈의-입력값\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88%EC%9D%98-%EC%9E%85%EB%A0%A5%EA%B0%92\" aria-label=\"모듈의 입력값 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈의 입력값</h2>\n<h2 id=\"모듈과-지역변수\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88%EA%B3%BC-%EC%A7%80%EC%97%AD%EB%B3%80%EC%88%98\" aria-label=\"모듈과 지역변수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈과 지역변수</h2>\n<h2 id=\"모듈과-출력\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88%EA%B3%BC-%EC%B6%9C%EB%A0%A5\" aria-label=\"모듈과 출력 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈과 출력</h2>\n<h2 id=\"모듈-사용-시-주의사항\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88-%EC%82%AC%EC%9A%A9-%EC%8B%9C-%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD\" aria-label=\"모듈 사용 시 주의사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈 사용 시 주의사항</h2>\n<p>모듈을 사용할 때, 아래의 주의사항에 대해 참고해주세요.</p>\n<h3 id=\"파일-경로-file-paths-인라인-블록-inline-blocks에-대하여\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EA%B2%BD%EB%A1%9C-file-paths-%EC%9D%B8%EB%9D%BC%EC%9D%B8-%EB%B8%94%EB%A1%9D-inline-blocks%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC\" aria-label=\"파일 경로 file paths 인라인 블록 inline blocks에 대하여 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 경로 File paths, 인라인 블록 Inline blocks에 대하여</h3>\n<p>파일 경로(File paths)</p>\n<ul>\n<li>\n<p>루트 모듈에서 file 함수 사용은 가능하지만, 별도의 폴더에 정의된 모듈에서 file 함수를 사용하기 위해서 경로 참조 path reference 표현식이 필요합니다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">path.module</code> : 표현식이 정의된 모듈의 파일 시스템 경로를 반환</p>\n</li>\n<li>\n<p><code class=\"language-text\">path.root</code> : 루트 모듈의 파일 시스템 경로를 반환</p>\n</li>\n<li>\n<p><code class=\"language-text\">path.cwd</code> : 현재 작업 중인 디렉터리의 파일 시스템 경로를 반환</p>\n</li>\n<li>\n<p>사용자 데이터 스크립트의 경우 모듈 자체에 상대 경로가 필요하므로 <code class=\"language-text\">modules/services/webserver-cluster/main.tf</code> 의 <code class=\"language-text\">templatefile</code> 데이터소스에서 <code class=\"language-text\">path.module</code> 사용</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>인라인 블록(Inline blocks)</p>\n<ul>\n<li>\n<p>일부 테라폼 리소스는 인라인 블록 또는 별도의 리소스(권장)로 정의 할 수 있습니다.</p>\n</li>\n<li>\n<p>다만 인라인 블록으로 규칙을 정의한 경우에는 코드가 작동하지 <strong>않습니다!</strong>. 아래와 같은 유사한 리소스를 사용하면 그런 문제가 발생할 수 있습니다:</p>\n<ul>\n<li>\n<p><code class=\"language-text\">aws_security_group</code> 과 <code class=\"language-text\">aws_security_group_rule</code></p>\n</li>\n<li>\n<p><code class=\"language-text\">aws_route_table</code> 과 <code class=\"language-text\">aws_route</code></p>\n</li>\n<li>\n<p><code class=\"language-text\">aws_network_acl</code> 과 <code class=\"language-text\">aws_network_acl_rule</code></p>\n</li>\n<li>\n<p>등등…</p>\n</li>\n</ul>\n</li>\n<li>\n<p>(스터디 중 논의) 이런 값들은 일일이 코드로 작성하는 편이 좀 더 변화에 유연하다고 하는 지적이 있었습니다.</p>\n</li>\n</ul>\n<h2 id=\"모듈-버전관리\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88-%EB%B2%84%EC%A0%84%EA%B4%80%EB%A6%AC\" aria-label=\"모듈 버전관리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈 버전관리</h2>\n<p>모듈에 대한 버전관리를 통해, 특정 환경(스테이징, 프로덕션 등)별로 보다 세부적인 관리를 진행하는 방안에 대해 소개합니다.</p>\n<ul>\n<li>여러 Repository를 통해 관리하는 전략을 소개하고자 합니다.\n<ul>\n<li>테라폼 모듈로 분리하고자 하는 로직은 별도의 Git repository를 생성하고, Git의 tag 기능을 활용하여 버저닝을 수행합니다.</li>\n<li>인프라를 관리하는 Git Repository에서는 아래 방안을 사용합니다.\n<ul>\n<li>상기 테라폼 모듈 로직에 대해 submodule로 추가하고, 스테이징/프로덕션에 대하여 tag에 기재한 버전을 사용합니다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"lessons-learned\" style=\"position:relative;\"><a href=\"#lessons-learned\" aria-label=\"lessons learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lessons Learned</h1>\n<p>제 4장에서는 아래의 내용을 반드시 기억하셨으면 좋겠습니다.</p>\n<ol>\n<li>테라폼의 모듈 사용으로 인해, 코드 재사용과 여러 테라폼 리소스에 대한 논리적 관리를 꾀할 수 있습니다.</li>\n<li>모듈 사용법을 읽고, 반복되는 내용을 어떻게 효과적으로 제어하는지 알아볼 수 있습니다.</li>\n<li>특히 주요 주의사항과 모듈 버전관리 전략에 대해 읽고, 모듈 사용시 의도치 않은 실수를 하지 않도록 대비할 수 있습니다.</li>\n</ol>\n<p>이것으로 제 4장을 마칩니다. 긴 글 읽어주셔서 감사합니다.</p>","fields":{"slug":"/devlog/terraform/2022-11-10---cloudneta-terraform-101-pt04//devlog/terraform/2022-11-10-cloudneta-terraform-101-pt04","tagSlugs":["/tag/terraform/","/tag/iac/","/tag/devops/"]},"frontmatter":{"date":"2022-11-10T04:11:57.000Z","description":"Terraform의 module 에 대한 소개와, 어떻게 활용하는지, 그리고 주의사항과 모듈 버전관리에 대한 내용을 담았습니다.","tags":["terraform","iac","devops"],"title":"[CloudNet@] 테라폼 스터디 4주차 - Terraform의 module에 대하여","socialImage":{"publicURL":"/static/2ac4339c55aea79af1fad3da4839b5c4/terraform04.jpg"}}}},"pageContext":{"slug":"/devlog/terraform/2022-11-10---cloudneta-terraform-101-pt04//devlog/terraform/2022-11-10-cloudneta-terraform-101-pt04"}},"staticQueryHashes":["251939775","357378587","401334301"]}